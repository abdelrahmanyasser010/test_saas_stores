name: Shorebird Build

on:
  workflow_dispatch:
    inputs:
      config_url:
        description: "Optional configuration URL for backend triggering"
        required: false
        default: ""
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ‚úÖ 1. Checkout source code
      - name: Checkout repository
        uses: actions/checkout@v4

      # ‚úÖ 2. Setup Flutter SDK
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.35.6"

      # ‚úÖ 3. Install dependencies
      - name: Get dependencies
        run: flutter pub get

      # ‚úÖ 4. Download and install Shorebird CLI
      - name: Download Shorebird CLI (via GitHub API)
        run: |
          echo "‚¨áÔ∏è Fetching Shorebird CLI download URL..."
          API_URL="https://api.github.com/repos/shorebirdtech/shorebird/releases/tags/v1.6.65"
          ASSET_URL=$(curl -s $API_URL | grep "browser_download_url" | grep "linux-gnu.tar.gz" | cut -d '"' -f 4)
          echo "Downloading from: $ASSET_URL"
          curl -L -o shorebird.tar.gz "$ASSET_URL"
          
          echo "üì¶ Extracting..."
          tar -xzf shorebird.tar.gz || (echo "‚ùå Extraction failed"; head -n 20 shorebird.tar.gz; exit 1)
          
          sudo mv shorebird /usr/local/bin/shorebird
          echo "‚úÖ Shorebird installed successfully."
          shorebird --version

